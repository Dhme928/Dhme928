<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>رفيقة - تقويم الدورة الشهرية</title>
<link href="https://fonts.googleapis.com/css2?family=Rakkas&display=swap" rel="stylesheet">
<style>
  :root {
    --primary-color: #e75480;
    --secondary-color: #4a004b;
    --light-pink-bg: #fff0f5;
    --header-font: 'Rakkas', cursive;
    --body-font: 'Arial', sans-serif;
  }
  body {
    font-family: var(--body-font);
    background: var(--light-pink-bg);
    margin: 0;
    padding: 0;
    color: var(--secondary-color);
    display: flex;
    flex-direction: column;
    min-height: 100vh;
  }
  header {
    background: var(--primary-color);
    color: white;
    padding: 15px;
    text-align: center;
    font-size: 22px;
    font-weight: bold;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    font-family: var(--header-font);
    position: sticky;
    top: 0;
    z-index: 1100;
  }
  .content {
    flex-grow: 1;
    padding: 20px 10px;
    overflow-y: auto;
  }
  .page { display: none; }
  .page.active { display: block; }

  /* Modal Styles (Onboarding & Day Click) */
  .modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.6);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 2000;
  }
  .modal-overlay.active {
      display: flex;
  }
  .modal-content {
    background: white;
    padding: 25px;
    border-radius: 15px;
    width: 90%;
    max-width: 400px;
    text-align: center;
    font-family: var(--body-font);
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
  }
  .modal-content h2, .modal-content h3 {
    font-family: var(--header-font);
    color: var(--primary-color);
    margin-top: 0;
  }
  .modal-content .form-group, .modal-content .day-actions {
    margin-bottom: 15px;
    text-align: right;
  }
   .modal-content .day-actions button {
       width: 100%;
       margin-bottom: 10px;
   }
  .modal-content label {
    display: block;
    margin-bottom: 5px;
    font-weight: bold;
    color: var(--secondary-color);
  }
  .modal-content input {
    width: 100%;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 8px;
    box-sizing: border-box;
  }
  .modal-content button, .action-button {
    width: 100%;
    padding: 12px;
    background: var(--primary-color);
    color: white;
    border: none;
    border-radius: 20px;
    font-family: var(--header-font);
    font-size: 18px;
    cursor: pointer;
    margin-top: 10px;
  }
   .action-button.secondary {
       background-color: #777;
   }

  /* Calendar Specific Styles */
  .calendar {
    max-width: 350px; margin: 20px auto; background: white;
    border-radius: 12px; box-shadow: 0 4px 12px rgba(231, 84, 128, 0.3);
    padding: 15px;
  }
  .month {
    text-align: center; font-size: 22px; font-weight: bold;
    margin-bottom: 15px; font-family: var(--header-font);
  }
  .weekdays {
    display: grid; grid-template-columns: repeat(7, 1fr);
    text-align: center; font-weight: bold; color: #a8326a; direction: rtl;
  }
  .days {
    display: grid; grid-template-columns: repeat(7, 1fr);
    text-align: center; gap: 5px; direction: rtl;
  }
  .day {
    padding: 4px 0; border-radius: 50%; cursor: pointer; user-select: none;
    font-size: 14px; position: relative; display: flex; justify-content: center;
    align-items: center; height: 42px; width: 42px; box-sizing: border-box;
    flex-direction: column; transition: background-color 0.2s;
  }
   .day .day-number { font-size: 14px; line-height: 1; font-weight: bold;}
   .day .emoji { font-size: 12px; line-height: 1; margin-top: 2px; height: 12px;}
  .day:hover { background: #ffe0eb; }
  .day.period { background: #f8c9d7; color: #a13d63; }
  .day.ovulation { background: #e0ffe0; color: #3b873b; }
  .day.pre-period { background: #f0e6fa; color: #764b8e; }
  .day.safe-day { background: #fffaf0; }
  .day.today .day-number {
      background-color: var(--primary-color);
      color: white;
      border-radius: 50%;
      padding: 4px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 24px;
      height: 24px;
  }
  .day.empty { background: transparent; cursor: default; }

  /* Trackers (Mood & Symptoms) */
  .tracker-container {
    max-width: 350px; margin: 15px auto; background: white;
    border-radius: 12px; box-shadow: 0 4px 12px rgba(231, 84, 128, 0.3);
    padding: 15px; text-align: center;
  }
  .tracker-container h3 {
    color: var(--primary-color); font-family: var(--header-font);
    font-size: 18px; margin-top: 0; margin-bottom: 15px;
  }
  .options-grid {
    display: flex; justify-content: space-around; flex-wrap: wrap; gap: 10px;
  }
  .tracker-option {
    font-size: 30px; cursor: pointer; padding: 5px;
    border-radius: 8px; transition: transform 0.2s, background-color 0.2s;
    background-color: transparent;
  }
  .tracker-option:hover { transform: scale(1.1); background-color: #ffe0eb; }
  .tracker-option.selected {
    background-color: #ffc0cb; border: 2px solid var(--primary-color); transform: scale(1.1);
  }

  .legend {
    max-width: 350px; margin: 15px auto; display: flex; flex-wrap: wrap;
    justify-content: center; font-size: 13px; gap: 10px;
  }
  .legend div { display: flex; align-items: center; gap: 6px; }
  .legend span {
      display: inline-block; width: 15px; height: 15px; border-radius: 50%;
  }

  .calendar-nav-actions {
    display: flex; justify-content: space-around; max-width: 350px;
    margin: 20px auto 10px; gap: 10px;
  }
  .calendar-nav-actions button {
    flex: 1; margin: 0; padding: 12px 10px;
    background: var(--primary-color); border: none; border-radius: 20px;
    color: white; font-weight: bold; font-size: 15px; cursor: pointer;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    font-family: var(--header-font);
  }

  /* Navigation Bar Styles */
  nav.tab-bar {
    display: flex; justify-content: space-around;
    background: var(--primary-color); padding: 10px 0;
    position: sticky; bottom: 0; width: 100%;
    box-shadow: 0 -2px 4px rgba(0,0,0,0.1); z-index: 1000;
  }
  nav.tab-bar button {
    background: none; border: none; color: white;
    font-size: 12px; display: flex; flex-direction: column;
    align-items: center; gap: 2px; cursor: pointer;
    padding: 5px 0; flex: 1; margin: 0;
    font-family: var(--header-font);
  }
  nav.tab-bar button.active { font-weight: bold; color: #ffdae9; }
  nav.tab-bar button i { font-size: 22px; }

  /* Page Content Wrapper */
  .page-content-wrapper { max-width: 700px; margin: 0 auto; padding: 0 10px; }
  .page h2 {
    color: var(--primary-color); text-align: center;
    margin-bottom: 20px; font-family: var(--header-font);
  }
  .page p {
    text-align: justify; color: #666; line-height: 1.6;
    font-family: var(--body-font); margin-bottom: 1em;
  }
  
  /* Articles & Fatwas Section */
  .articles-container {
    display: flex; flex-wrap: wrap; justify-content: center;
    gap: 15px; margin-top: 20px;
  }
  .article-box {
    background: white; border-radius: 12px;
    box-shadow: 0 4px 12px rgba(231, 84, 128, 0.2);
    padding: 15px; max-width: 320px; width: 100%;
    text-align: right; display: flex; flex-direction: column;
  }
  .article-box h3 {
    color: var(--primary-color); font-size: 18px; margin-top: 0; margin-bottom: 10px;
    font-family: var(--header-font); text-align: right;
  }
  .article-preview {
    font-size: 14px; color: #555; line-height: 1.5; margin-bottom: 10px;
    font-family: var(--body-font); flex-grow: 1; text-align: justify;
  }
  .article-full-content {
    max-height: 0; overflow: hidden; transition: max-height 0.5s ease-out;
    text-align: justify; padding-top: 10px;
    border-top: 1px dashed #ffe0eb; margin-top: 10px;
  }
  .article-full-content.active { max-height: 1500px; transition: max-height 0.7s ease-in; }
  .toggle-article {
    display: block; text-align: left; color: #a8326a; text-decoration: none;
    font-weight: bold; font-size: 13px; background: none; border: none;
    padding: 0; cursor: pointer; margin-top: 10px; align-self: flex-start;
  }
  
  /* Settings and Statistics Page Styles */
  .settings-form, .stats-container {
    background: white; padding: 20px; border-radius: 12px;
    box-shadow: 0 4px 12px rgba(231, 84, 128, 0.3);
  }
  .data-management { margin-top: 30px; border-top: 1px solid #eee; padding-top: 20px; }
  .data-management h3 { color: var(--secondary-color); font-family: var(--header-font); }
  .delete-button {
      background-color: #d9534f;
      border: none; padding: 12px; color: white;
      width: 100%; border-radius: 8px; cursor: pointer;
      font-family: var(--body-font); font-weight: bold; margin-top: 10px;
  }
    .full-reset-button { background-color: #c9302c; }
  .form-group { margin-bottom: 15px; }
  .form-group label { display: block; margin-bottom: 5px; font-weight: bold; }
  .form-group input {
    width: 100%; padding: 10px; border: 1px solid #ddd;
    border-radius: 8px; box-sizing: border-box;
  }
  .save-btn {
    width: 100%; padding: 12px; background: var(--primary-color); color: white;
    border: none; border-radius: 20px; font-family: var(--header-font);
    font-size: 18px; cursor: pointer; margin-top: 10px;
  }
  .stats-item {
    background: var(--light-pink-bg); padding: 15px;
    border-radius: 10px; margin-bottom: 10px;
    display: flex; justify-content: space-between; align-items: center;
  }
  .stats-item .label { font-weight: bold; }
  .stats-item .value {
    font-family: var(--header-font); font-size: 20px;
    color: var(--primary-color);
  }
  .stats-note { font-size: 13px; color: #888; text-align: center; margin-top: 20px; }

  /* Notes page */
   .notes-textarea {
    width: 90%; max-width: 500px; display: block; margin: 20px auto;
    padding: 10px; border: 1px solid #ffc0cb; border-radius: 8px;
    min-height: 150px; font-size: 16px; color: var(--secondary-color);
    box-shadow: inset 0 1px 3px rgba(0,0,0,0.05); font-family: var(--body-font);
  }

</style>
</head>
<body>

<div id="onboardingModal" class="modal-overlay">
  <div class="modal-content">
    <h2>💖 أهلاً بكِ في رفيقة</h2>
    <p>لنبدأ بتخصيص تجربتكِ. يرجى إدخال بعض المعلومات الأولية.</p>
    <form id="onboardingForm">
      <div class="form-group">
        <label for="onboardingCycleLength">كم متوسط عدد أيام دورتكِ الكاملة؟ (من بداية حيض لبداية الحيض التالي)</label>
        <input type="number" id="onboardingCycleLength" value="28" required>
      </div>
      <div class="form-group">
        <label for="onboardingPeriodLength">كم متوسط عدد أيام النزيف (الحيض)؟</label>
        <input type="number" id="onboardingPeriodLength" value="5" required>
      </div>
      <div class="form-group">
        <label for="onboardingLastPeriod">متى كان أول يوم في آخر دورة لكِ؟</label>
        <input type="date" id="onboardingLastPeriod" required>
      </div>
      <button type="submit">حفظ والبدء</button>
    </form>
  </div>
</div>

<div id="dayClickModal" class="modal-overlay">
    <div class="modal-content">
        <h3 id="dayClickModalTitle"></h3>
        <div class="day-actions">
            <button id="startPeriodBtnModal" class="action-button">🩸 بدء الدورة في هذا اليوم</button>
            <button id="endPeriodBtnModal" class="action-button">✅ إنهاء الدورة في هذا اليوم</button>
        </div>
        <button id="closeDayClickModalBtn" class="action-button secondary">إغلاق</button>
    </div>
</div>


<header id="appHeader">رفيقة 💕 - تقويم الدورة الشهرية</header>

<div class="content">
  <div id="menstrualCalendar" class="page active">
    <div class="calendar" aria-label="تقويم الدورة الشهرية">
      <div class="month" id="monthYear"></div>
      <div class="weekdays">
        <div>أحد</div><div>اثنين</div><div>ثلاثاء</div><div>أربعاء</div><div>خميس</div><div>جمعة</div><div>سبت</div>
      </div>
      <div class="days" id="daysGrid"></div>
    </div>
    <div class="legend">
      <div><span style="background: #f8c9d7;"></span> أيام الدورة</div>
      <div><span style="background: #e0ffe0;"></span> أيام التبويض</div>
      <div><span style="background: #f0e6fa;"></span> ما قبل الدورة</div>
      <div><span style="background: #fffaf0;"></span> أيام آمنة</div>
    </div>
    <div class="calendar-nav-actions">
        <button id="prevMonthBtn">الشهر السابق</button>
        <button id="nextMonthBtn">الشهر التالي</button>
    </div>

    <div class="tracker-container">
      <h3>كيف مزاجك اليوم؟</h3>
      <div class="options-grid" id="moodTracker">
        <span class="tracker-option mood-option" data-mood="😍">😍</span>
        <span class="tracker-option mood-option" data-mood="😊">😊</span>
        <span class="tracker-option mood-option" data-mood="😌">😌</span>
        <span class="tracker-option mood-option" data-mood="😴">😴</span>
        <span class="tracker-option mood-option" data-mood="🤔">🤔</span>
        <span class="tracker-option mood-option" data-mood="😠">😠</span>
      </div>
    </div>
    
    <div class="tracker-container">
        <h3>هل تشعرين بأي أعراض اليوم؟</h3>
        <div class="options-grid" id="symptomTracker">
          <span class="tracker-option symptom-option" title="تقلصات" data-symptom="تقلصات">🤕</span>
          <span class="tracker-option symptom-option" title="صداع" data-symptom="صداع">🤯</span>
          <span class="tracker-option symptom-option" title="إرهاق" data-symptom="إرهاق">😩</span>
          <span class="tracker-option symptom-option" title="انتفاخ" data-symptom="انتفاخ">🐡</span>
          <span class="tracker-option symptom-option" title="حب شباب" data-symptom="حب شباب">🍓</span>
          <span class="tracker-option symptom-option" title="ألم ظهر" data-symptom="ألم ظهر">🦴</span>
        </div>
      </div>
  </div>

  <div id="religiousFatwas" class="page">
     <div class="page-content-wrapper">
      <h2>🧕 قسم فتاوى الطهارة والدورة</h2>
      <p style="text-align: center;">يحتوي هذا القسم على فتاوى شرعية مهمة تتعلق بأحكام الطهارة والدورة الشهرية، معتمدين على فتاوى سماحة الشيخ عبد العزيز بن باز رحمه الله.</p>
      <div class="articles-container" id="fatwasContainer">
          </div>
      <p style="text-align: center; margin-top: 20px; font-size: 13px;"> ملاحظة هامة: هذه الفتاوى مقتبسة من موقع سماحة الشيخ عبد العزيز بن باز رحمه الله (binbaz.org.sa) لغرض التوضيح والمعرفة العامة. للمسائل الشرعية الدقيقة، يرجى الرجوع إلى أهل العلم الثقات.</p>
    </div>
  </div>

  <div id="articles" class="page">
     <div class="page-content-wrapper">
        <h2>📚 مقالات ثقافية ودينية</h2>
        <p style="text-align: center;">مجموعة من المقالات الهادفة التي تتناول مواضيع تهم الفتاة المسلمة، لزيادة الوعي والمعرفة.</p>
        <div class="articles-container" id="articlesContainer">
            </div>
      </div>
  </div>
  
  <div id="statistics" class="page">
    <div class="page-content-wrapper">
      <h2>📊 إحصائيات دورتكِ</h2>
      <p style="text-align: center;">هنا ملخص لبيانات دوراتكِ المسجلة لمساعدتكِ على فهم طبيعة جسمكِ بشكل أفضل.</p>
      <div id="statsContainer" class="stats-container">
        </div>
      <div class="stats-note">
        ملاحظة: هذه الأرقام هي متوسطات محسوبة من الدورات التي قمتِ بتسجيلها في التطبيق. كلما زاد عدد الدورات المسجلة، كانت الإحصائيات أكثر دقة.
      </div>
    </div>
  </div>

  <div id="settings" class="page">
    <div class="page-content-wrapper">
        <h2>⚙️ الإعدادات</h2>
        <p style="text-align: center;">يمكنكِ تعديل تفضيلاتكِ هنا في أي وقت لتحديث توقعات التقويم.</p>
        <div class="settings-form">
            <div class="form-group">
                <label for="settingCycleLength">متوسط طول الدورة الكاملة (بالأيام)</label>
                <input type="number" id="settingCycleLength">
            </div>
            <div class="form-group">
                <label for="settingPeriodLength">متوسط مدة النزيف/الحيض (بالأيام)</label>
                <input type="number" id="settingPeriodLength">
            </div>
            <button id="saveSettingsBtn" class="save-btn">حفظ التغييرات</button>

            <div class="data-management">
                <h3>إدارة البيانات</h3>
                <p>إذا قمتِ بتسجيل دورة بالخطأ، يمكنك حذف آخر دورة تم إدخالها من هنا.</p>
                <button id="deleteLastCycleBtn" class="delete-button">حذف آخر دورة تم تسجيلها</button>
                <p style="margin-top: 20px;">للبدء من جديد، يمكنك حذف جميع بيانات التطبيق والعودة لشاشة البداية.</p>
                <button id="fullResetBtn" class="delete-button full-reset-button">إعادة تعيين التطبيق بالكامل</button>
            </div>
        </div>
    </div>
  </div>

  <div id="personalNotes" class="page">
    <div class="page-content-wrapper">
      <h2>💬 ملاحظاتي الشخصية</h2>
      <p>يمكنك استخدام هذه الواجهة لتدوين ملاحظاتك الشخصية، تذكير بالمهام، أو أي شيء ترغبين في تدوينه.</p>
      
      <div style="font-family: 'Rakkas', cursive; font-size: 20px; color: #e75480; background-color: #fff0f5; padding: 15px; border-radius: 12px; margin-bottom: 15px; text-align: center;">
        🌷 إلى من ستكون رفيقة دربي، وزهرة عمري.. <strong>منى</strong> 💕<br>
        هذا التطبيق من قلب يحبك، اسمه "رفيقة" لأنه يشبهك.
      </div>

      <textarea id="notesInput" class="notes-textarea" placeholder="اكتبي ملاحظاتك هنا..."></textarea>
      <button id="saveNotesBtn" class="save-btn">حفظ الملاحظات</button>
    </div>
  </div>
</div>

<nav class="tab-bar">
  <button data-page="menstrualCalendar" class="active">
    <i class="icon">🩸</i>
    التقويم
  </button>
  <button data-page="statistics">
    <i class="icon">📊</i>
    إحصائيات
  </button>
  <button data-page="religiousFatwas">
    <i class="icon">🧕</i>
    فتاوى
  </button>
  <button data-page="articles">
    <i class="icon">📚</i>
    مقالات
  </button>
  <button data-page="settings">
    <i class="icon">⚙️</i>
    إعدادات
  </button>
  <button data-page="personalNotes">
    <i class="icon">💬</i>
    ملاحظاتي
  </button>
</nav>

<script>
// --- DATA: Fatwas & Articles ---
const fatwasData = [
    { title: "حكم الصلاة والصيام للحائض", preview: "س/ ما حكم الصلاة والصيام على الحائض والنفساء؟...", full: "<p><b>السؤال:</b> ما حكم الصلاة والصيام على الحائض والنفساء؟</p><p><b>الجواب:</b> لا صلاة عليها ولا صيام، لا فرض ولا نفل، وعليها قضاء الصيام دون الصلاة؛ لما ثبت عن عائشة رضي الله عنها قالت: ((كنا نؤمر بقضاء الصيام ولا نؤمر بقضاء الصلاة)) متفق على صحته.</p>", source: "https://binbaz.org.sa/fatwas/8099" },
    { title: "متى تغتسل الحائض وتصلي؟", preview: "س/ إذا طهرت المرأة قبل الفجر هل تصوم وتصلي؟...", full: "<p><b>السؤال:</b> إذا طهرت المرأة قبل الفجر هل تصوم وتصلي؟</p><p><b>الجواب:</b> إذا طهرت المرأة من حيضها أو نفاسها قبل الفجر ولو بدقيقة أو دقيقتين فإنها تصوم ذلك اليوم وعليها الغسل، وعليها أن تصلي صلاة الفجر.</p>", source: "https://binbaz.org.sa/fatwas/11317" },
    { title: "علامة الطهر من الحيض", preview: "س/ ما علامة الطهر من الحيض؟ ج/ علامة الطهر أحد أمرين: إما القصة البيضاء أو الجفاف...", full: "<p><b>السؤال:</b> ما علامة الطهر من الحيض؟</p><p><b>الجواب:</b> علامة الطهر أحد أمرين: إما أن يأتيها البياض الذي يعرف عند النساء بأنه الطهر (القصة البيضاء)، وإما أن تأتيها جفافة، بحيث لو وضعت قطنة على فرجها خرجت ليس فيها شيء من دم ولا صفرة ولا كدرة. فإذا رأت الطهر بالبياض أو بالجفافة، فإنها تغتسل وتصلي وتصوم وتحل لزوجها.</p>", source: "https://binbaz.org.sa/fatwas/10758" },
    { title: "حكم الصفرة والكدرة بعد الطهر", preview: "س/ ما حكم الصفرة والكدرة التي تراها المرأة بعد انتهاء دورتها؟...", full: "<p><b>السؤال:</b> ما حكم الصفرة والكدرة التي تراها المرأة بعد انتهاء دورتها؟</p><p><b>الجواب:</b> الصفرة والكدرة بعد الطهر لا تعد شيئًا، ولا تلتفت إليها المرأة. إذا طهرت المرأة من الحيض، ورأت البياض الخالص، أو الجفافة، فما يأتي بعد ذلك من صفرة أو كدرة فليس بشيء، ولا يمنع الصلاة والصيام.</p>", source: "https://binbaz.org.sa/fatwas/14294" },
    { title: "قراءة القرآن للحائض", preview: "س/ هل يجوز للحائض قراءة القرآن عن ظهر قلب؟...", full: "<p><b>السؤال:</b> هل يجوز للحائض والنفساء قراءة القرآن عن ظهر قلب؟</p><p><b>الجواب:</b> لا حرج في أن تقرأ الحائض والنفساء القرآن عن ظهر قلب؛ لأن مدتهما تطول، وقياسهما على الجنب غير صحيح. أما مس المصحف فلا يجوز لهما.</p>", source: "https://binbaz.org.sa/fatwas/4387" },
    { title: "استعمال حبوب منع الحيض", preview: "س/ هل يجوز للمرأة أن تستعمل حبوبًا لقطع دم الحيض في رمضان أو الحج؟...", full: "<p><b>السؤال:</b> هل يجوز للمرأة أن تستعمل حبوبًا لقطع دم الحيض في رمضان أو الحج؟</p><p><b>الجواب:</b> لا بأس بذلك إذا لم يكن فيه مضرة، إذا استعملت المرأة حبوب منع الدورة أو رفعها، حتى تصلي وتطوف مع الناس، أو تصوم مع الناس، فلا بأس، إذا قرر الأطباء أن لا مضرة في ذلك.</p>", source: "https://binbaz.org.sa/fatwas/5306" },
    { title: "إذا طهرت قبل المغرب", preview: "س/ إذا طهرت الحائض قبل غروب الشمس، فماذا تفعل؟...", full: "<p><b>السؤال:</b> إذا طهرت الحائض قبل غروب الشمس، فماذا تفعل؟</p><p><b>الجواب:</b> إذا طهرت الحائض قبل غروب الشمس، وجب عليها أن تصلي الظهر والعصر في أصح قولي العلماء. وهكذا لو طهرت قبل طلوع الفجر، وجب عليها أن تصلي المغرب والعشاء.</p>", source: "https://binbaz.org.sa/fatwas/18797" },
    { title: "حكم الدم العائد بعد الطهر", preview: "س/ إذا اغتسلت المرأة من الحيض، ثم خرج منها دم خفيف، فماذا تفعل؟...", full: "<p><b>السؤال:</b> إذا اغتسلت المرأة من الحيض، ثم خرج منها دم خفيف بعد يوم أو يومين، فماذا تفعل؟</p><p><b>الجواب:</b> إذا كان الدم العائد في مدة العادة، فهو حيض. أما إن كان بعد انتهاء مدة العادة، فإن كان صفرة أو كدرة فليس بحيض، وإن كان دماً صريحاً فهو حيض، ما لم يتكرر بحيث تعلم أنه دم فساد واستحاضة.</p>", source: "https://binbaz.org.sa/fatwas/2464" },
    { title: "الطواف للحائض", preview: "س/ هل يجوز للحائض الطواف بالبيت؟...", full: "<p><b>السؤال:</b> هل يجوز للحائض الطواف بالبيت؟</p><p><b>الجواب:</b> لا يجوز للحائض الطواف بالبيت، ولا الصلاة فيه، حتى تطهر؛ لقول النبي ﷺ لعائشة رضي الله عنها لما حاضت: ((افعلي ما يفعل الحاج غير ألا تطوفي بالبيت حتى تطهري)).</p>", source: "https://binbaz.org.sa/fatwas/8097" },
    { title: "الجمع بين الصلاتين للحائض إذا طهرت", preview: "س/ إذا طهرت الحائض في وقت العصر، هل تصلي الظهر معه؟...", full: "<p><b>السؤال:</b> إذا طهرت الحائض في وقت العصر، فهل تصلي الظهر معه؟</p><p><b>الجواب:</b> نعم، إذا طهرت الحائض في وقت العصر فإنها تصلي الظهر والعصر جميعًا، وإذا طهرت في وقت العشاء فإنها تصلي المغرب والعشاء جميعًا، هذا هو الذي أفتى به جماعة من أصحاب النبي ﷺ.</p>", source: "https://binbaz.org.sa/fatwas/2468" },
    { title: "حكم دخول الحائض المسجد", preview: "س/ هل يجوز للمرأة الحائض دخول المسجد لحضور الدروس؟...", full: "<p><b>السؤال:</b> هل يجوز للمرأة الحائض دخول المسجد لحضور حلقة علم؟</p><p><b>الجواب:</b> لا يجوز للحائض أن تجلس في المسجد، لكن يجوز لها المرور مع التحفظ من نزول شيء من الدم، لقوله تعالى: {وَلَا جُنُبًا إِلَّا عَابِرِي سَبِيلٍ حَتَّى تَغْتَسِلُوا}، والحائض في معنى الجنب.</p>", source: "https://binbaz.org.sa/fatwas/4141" },
    { title: "الاستحاضة وأحكامها", preview: "س/ ما الفرق بين الحيض والاستحاضة؟ وما أحكام المستحاضة؟...", full: "<p><b>السؤال:</b> ما هي الاستحاضة وما أحكامها؟</p><p><b>الجواب:</b> الاستحاضة دم يجري في غير أوقات الحيض، وهو دم عرق لا يمنع الصلاة ولا الصيام. وعلى المستحاضة أن تتحفظ بقطن ونحوه، وتتوضأ لوقت كل صلاة وتصلي، ولها أن تجمع بين الظهرين والعشاءين بغسل واحد أو وضوء واحد.</p>", source: "https://binbaz.org.sa/fatwas/4412" },
    { title: "حكم صوم من أتاها الحيض قبل الغروب", preview: "س/ إذا جاء الحيض للمرأة وهي صائمة قبل غروب الشمس بدقائق، فهل يبطل صومها؟...", full: "<p><b>السؤال:</b> ما حكم صوم من أتاها الحيض قبل الغروب بلحظات؟</p><p><b>الجواب:</b> إذا أتاها الحيض قبل غروب الشمس ولو بدقيقة بطل صومها وعليها القضاء، وهذا بإجماع أهل العلم.</p>", source: "https://binbaz.org.sa/fatwas/11316" },
    { title: "لمس المصحف للحائض بحائل", preview: "س/ هل يجوز للحائض أن تقرأ من المصحف بحائل كالقفازين؟...", full: "<p><b>السؤال:</b> هل يجوز للمرأة الحائض أن تلمس المصحف وهي لابسة للقفازين؟</p><p><b>الجواب:</b> نعم، يجوز لها أن تقرأ في المصحف عن ظهر قلب، وأن تلمسه بحائل كالقفازين ونحوهما عند الحاجة، أما اللمس مباشرة فلا يجوز.</p>", source: "https://binbaz.org.sa/fatwas/14275" },
    { title: "أقل مدة للحيض وأكثرها", preview: "س/ هل للحيض مدة محددة بالأيام؟...", full: "<p><b>السؤال:</b> هل هناك حد لأقل الحيض وأكثره؟</p><p><b>الجواب:</b> الصحيح أنه لا حد لأقله ولا لأكثره، بل المرجع هو العادة والعرف. فما تراه المرأة من دم في زمن عادتها فهو حيض، وما زاد عن ذلك فهو استحاضة، إلا إذا تغيرت العادة.</p>", source: "https://binbaz.org.sa/fatwas/5903" },
    { title: "حكم الدم قبل العادة بيومين", preview: "س/ الدم الذي تراه المرأة قبل عادتها بيوم أو يومين، هل يعتبر حيضًا؟...", full: "<p><b>السؤال:</b> الدم الذي تراه المرأة قبل عادتها بيوم أو يومين، هل يعتبر حيضًا؟</p><p><b>الجواب:</b> إذا كان الدم الذي رأته قبل العادة متصلاً بها فهو من الحيض، أما إذا كان منفصلاً بأن رأت يوماً دماً ثم طهرت يوماً أو يومين ثم رأت دم العادة، فالأول ليس بحيض.</p>", source: "https://binbaz.org.sa/fatwas/14294" },
    { title: "أحكام النفساء", preview: "س/ ما هي أحكام النفساء؟ ومتى تطهر؟...", full: "<p><b>السؤال:</b> ما أحكام النفساء؟</p><p><b>الجواب:</b> النفساء حكمها حكم الحائض في جميع ما يحرم عليها ويسقط عنها. وأكثر مدة النفاس أربعون يوماً، فإذا طهرت قبل ذلك اغتسلت وصلت وصامت. وإن استمر الدم بعد الأربعين فهو دم فساد (استحاضة)، لا تترك له الصلاة والصيام.</p>", source: "https://binbaz.org.sa/fatwas/8100" },
    { title: "إذا انقطع الدم أقل من يوم", preview: "س/ إذا انقطع الدم عن الحائض أقل من يوم ثم عاد، فما الحكم؟...", full: "<p><b>السؤال:</b> إذا انقطع الدم عن الحائض أقل من يوم ثم عاد، فهل يعتبر طهراً؟</p><p><b>الجواب:</b> الطهر المتقطع خلال أيام العادة لا يعتبر طهراً، فالمرأة لا تزال في حكم الحائض حتى ترى علامة الطهر الواضحة من القصة البيضاء أو الجفاف التام.</p>", source: "https://binbaz.org.sa/fatwas/5595" },
    { title: "الذكر والدعاء للحائض", preview: "س/ هل يجوز للحائض ذكر الله والدعاء؟...", full: "<p><b>السؤال:</b> هل يجوز للحائض ذكر الله والدعاء؟</p><p><b>الجواب:</b> نعم، يشرع للحائض والنفساء الإكثار من ذكر الله بالتسبيح والتهليل والتحميد والتكبير، والدعاء والاستغفار، ولا حرج في ذلك بالإجماع.</p>", source: "https://binbaz.org.sa/fatwas/4387" },
    { title: "صلاة العيد للحائض", preview: "س/ هل تخرج الحائض لصلاة العيد؟...", full: "<p><b>السؤال:</b> هل تخرج الحائض لصلاة العيد؟</p><p><b>الجواب:</b> نعم، تخرج الحائض مع المسلمين إلى مصلى العيد، ولكنها تعتزل المصلى، وتشهد الخير ودعوة المسلمين، ولا تصلي.</p>", source: "https://binbaz.org.sa/fatwas/8098" },
    { title: "سجود التلاوة للحائض", preview: "س/ هل تسجد الحائض سجود التلاوة؟...", full: "<p><b>السؤال:</b> هل تسجد الحائض سجود التلاوة إذا مرت بآية سجدة؟</p><p><b>الجواب:</b> الصحيح أنه يجوز للحائض أن تسجد سجود التلاوة، لأنها ليست صلاة، وإنما هي خضوع لله وذل بين يديه.</p>", source: "https://binbaz.org.sa/fatwas/2471" },
    { title: "طهرت ثم سافرت هل تقصر وتجمع", preview: "س/ امرأة طهرت وهي في السفر، كيف تصلي؟...", full: "<p><b>السؤال:</b> امرأة طهرت وهي في السفر، هل تصلي صلاة مقيم أم مسافر؟</p><p><b>الجواب:</b> إذا طهرت وهي في السفر فإنها تصلي صلاة مسافر، تقصر الرباعية ركعتين، ولها أن تجمع بين الظهر والعصر، وبين المغرب والعشاء.</p>", source: "https://binbaz.org.sa/fatwas/15694" },
    { title: "حكم الأدوية التي تؤخر الدورة", preview: "س/ ما حكم استعمال الأدوية التي تؤخر الحيض لأجل الصيام؟...", full: "<p><b>السؤال:</b> ما حكم استعمال الأدوية التي تؤخر الحيض لأجل الصيام؟</p><p><b>الجواب:</b> لا حرج في ذلك إذا لم يكن فيها ضرر على المرأة، وبعد استشارة الطبيبة المختصة. والأفضل ترك الأمر على طبيعته التي خلقها الله عليها.</p>", source: "https://binbaz.org.sa/fatwas/5306" },
    { title: "الدم بعد سن اليأس", preview: "س/ الدم الذي تراه المرأة بعد سن اليأس، هل هو حيض؟...", full: "<p><b>السؤال:</b> ما حكم الدم الذي تراه المرأة الكبيرة بعد سن اليأس؟</p><p><b>الجواب:</b> الغالب أن الدم بعد سن الخمسين يكون دم فساد واستحاضة، فلا تترك له الصلاة والصيام. ولكن إذا كان الدم يأتي على هيئة الحيض المعروف وبصفاته، فهو حيض على الصحيح.</p>", source: "https://binbaz.org.sa/fatwas/2467" },
    { title: "إذا شكّت في الطهر", preview: "س/ إذا شكت المرأة هل طهرت أم لا، فماذا تفعل؟...", full: "<p><b>السؤال:</b> إذا شكت المرأة في حصول الطهر، فماذا تفعل؟</p><p><b>الجواب:</b> الأصل بقاء الحيض، فلا تغتسل ولا تصلي حتى تتيقن الطهر برؤية القصة البيضاء أو الجفاف التام.</p>", source: "https://binbaz.org.sa/fatwas/10758" },
    { title: "صيام يوم عرفة للحائض", preview: "س/ هل تصوم الحائض يوم عرفة إذا طهرت خلال اليوم؟...", full: "<p><b>السؤال:</b> هل يصح صوم يوم عرفة لمن طهرت في أثنائه؟</p><p><b>الجواب:</b> لا يصح صومها ذلك اليوم، لأنها لم تكن صائمة من أوله. وعليها قضاء صيام الفرض إذا كان رمضان، أما النفل فلا قضاء عليه.</p>", source: "https://binbaz.org.sa/fatwas/11316" },
    { title: "إذا حاضت بعد الإحرام", preview: "س/ امرأة أحرمت بالعمرة ثم حاضت، ماذا تفعل؟...", full: "<p><b>السؤال:</b> امرأة أحرمت بالعمرة ثم فاجأها الحيض قبل الطواف، ماذا تفعل؟</p><p><b>الجواب:</b> تبقى على إحرامها حتى تطهر، ثم تغتسل وتطوف وتسعى. فإن خشيت فوات الحج، فإنها تحرم بالحج وتصير قارنة، وتفعل ما يفعله الحاج غير الطواف بالبيت حتى تطهر.</p>", source: "https://binbaz.org.sa/fatwas/1749" },
    { title: "هل تقضي الحائض السنن الرواتب", preview: "س/ هل تقضي الحائض السنن الرواتب بعد طهرها؟...", full: "<p><b>السؤال:</b> هل تقضي الحائض السنن الرواتب التي فاتتها أثناء الحيض؟</p><p><b>الجواب:</b> لا يشرع لها قضاء السنن الرواتب، كما لا يشرع لها قضاء الصلوات المفروضة. إنما تقضي الصيام الواجب فقط.</p>", source: "https://binbaz.org.sa/fatwas/8099" },
    { title: "الاعتمار في زمن الحيض", preview: "س/ هل يجوز للمرأة أن تسافر للعمرة وهي حائض؟...", full: "<p><b>السؤال:</b> هل يجوز للمرأة أن تسافر للعمرة وهي حائض؟</p><p><b>الجواب:</b> نعم، يجوز لها السفر، وتحرم من الميقات، وتبقى في الفندق حتى تطهر، ثم تغتسل وتؤدي مناسك العمرة من طواف وسعي.</p>", source: "https://binbaz.org.sa/fatwas/1749" },
    { title: "تفسير رؤية الدم في المنام للحائض", preview: "س/ هل لرؤية الدم في المنام علاقة بالحيض؟...", full: "<p><b>الجواب:</b> لا علاقة بين الأحلام وبين أحكام الحيض الشرعية. المرجع في أحكام الحيض هو رؤية الدم الحقيقي في اليقظة.</p>", source: "https://binbaz.org.sa/fatwas/2193" }
];
const articlesData = [
    { title: "💖 جمالك الداخلي: ركيزة سعادتك", preview: "الجمال لا يقتصر على المظهر الخارجي، بل ينبع من الداخل...", full: "<p>الجمال لا يقتصر على المظهر الخارجي، بل ينبع من الداخل، من نقاء روحكِ، وصفاء قلبكِ. هو تلك الثقة التي تشعين بها، والطاقة الإيجابية التي تبثينها لمن حولكِ. عندما تعتنين بجمالكِ الداخلي، فإنكِ تبنين أساساً متيناً لسعادتكِ وراحتكِ النفسية.</p>" },
    { title: "🌷 أسرار تنظيم الوقت للطالبة المسلمة", preview: "هل تشعرين بضيق الوقت؟ تعلمي استراتيجيات فعالة لإدارة وقتكِ...", full: "<p>بين الدراسة، والعبادة، والأنشطة الاجتماعية، قد تشعرين بضيق الوقت. لكن بتنظيم جيد، يمكنكِ تحقيق التوازن. إليكِ بعض الأسرار: 1. تحديد الأولويات. 2. تخصيص وقت للعبادة. 3. الابتعاد عن المشتتات. 4. النوم الكافي. 5. المرونة.</p>" },
    { title: "🧘‍♀️ الصداقة في الإسلام: اختيار الرفيقة الصالحة", preview: "تُعد الصداقة كنزاً حقيقياً. تعرفي على معايير الصداقة الصحيحة...", full: "<p>قال رسول الله ﷺ: 'المرء على دين خليله، فلينظر أحدكم من يخالل'. الرفيقة الصالحة هي من تذكركِ بالله، وتحثكِ على الخير، وتعينكِ على طاعته. ابحثي عن التقوى، والأخلاق الحسنة، والنصح الصادق في صديقاتكِ.</p>" },
    { title: "📖 كيف تبنين علاقة قوية مع القرآن الكريم؟", preview: "القرآن نور وهدى. اكتشفي طرقاً عملية لتقوية علاقتكِ بكتاب الله...", full: "<p>بناء علاقة قوية مع القرآن رحلة تبدأ بالاستمرارية. خصصي ورداً يومياً ولو صفحة واحدة، حاولي فهم المعاني وتدبرها، استمعي لتلاوات متقنة، واجعلي الدعاء رفيقكِ ليفتح الله عليكِ فهم كتابه والعمل به.</p>" },
    { title: "🧠 فن التعامل مع الضغوط النفسية", preview: "الحياة مليئة بالتحديات. تعلمي مهارات التكيف مع الضغوط...", full: "<p>عندما تشعرين بالضغط، تذكري قوة التنفس العميق. مارسي رياضة خفيفة، تحدثي مع شخص تثقين به، وامنحي نفسكِ وقتاً للاسترخاء. الأهم من ذلك، ثقي بأن مع العسر يسراً وتوكلي على الله في كل أموركِ.</p>" },
    { title: "🌸 أهمية الحياء في شخصية الفتاة المسلمة", preview: "الحياء زينة المرأة المسلمة. استكشفي مفهوم الحياء الشامل...", full: "<p>الحياء ليس مجرد خجل، بل هو خُلق يبعث على فعل الحسن واجتناب القبيح. قال ﷺ: 'الحياء لا يأتي إلا بخير'. إنه صيانة للكرامة، وجاذبية روحية، ودليل على قوة الإيمان ورقي الأخلاق.</p>" },
    { title: "✨ قوة التفاؤل وحسن الظن بالله", preview: "التفاؤل ليس تجاهلاً للمصاعب، بل هو ثقة بأن الله سيجعل مخرجاً...", full: "<p>تفاءلي بالخير تجديه. حسن الظن بالله عبادة قلبية عظيمة تجلب الطمأنينة والسكينة. تذكري دائماً أن أقدار الله كلها خير، حتى وإن بدت مؤلمة في ظاهرها. انظري للجانب المشرق وثقي بتدبير الله لكِ.</p>" },
    { title: "🌿 التغذية الصحية وأثرها على المزاج", preview: "ما تأكلينه يؤثر مباشرة على صحتك النفسية والجسدية...", full: "<p>ركزي على الأطعمة الطبيعية كالخضروات والفواكه والحبوب الكاملة. قللي من السكريات والأطعمة المصنعة. شرب كميات كافية من الماء له تأثير عجيب على طاقتك وتركيزك. جسمكِ أمانة، فاعتني به.</p>" },
    { title: "💪 كيف تبنين ثقتك بنفسك؟", preview: "الثقة بالنفس ليست غروراً، بل هي تقديركِ لذاتكِ وقدراتكِ...", full: "<p>ابدئي بتحديد نقاط قوتكِ والاعتراف بها. ضعي أهدافاً صغيرة وحققيها لتشعري بالإنجاز. لا تقارني نفسكِ بالآخرين، فرِحلتكِ فريدة. وتذكري أن قيمتكِ الحقيقية تنبع من علاقتكِ بخالقكِ.</p>" },
    { title: "🕊️ فن التسامح والصفح", preview: "التسامح ليس ضعفاً، بل هو قوة تحرر روحكِ من أغلال الحقد...", full: "<p>عندما تسامحين، فأنتِ تهدين نفسكِ السلام الداخلي قبل كل شيء. التسامح لا يعني نسيان الأذى، بل يعني عدم السماح له بالتحكم في حاضركِ ومستقبلكِ. استحضري الأجر العظيم من الله لمن يعفو ويصفح.</p>" },
    { title: "🎯 تحديد الأهداف وتحقيقها", preview: "الأهداف تمنح حياتكِ وجهة ومعنى. تعلمي كيف تضعين أهدافاً ذكية...", full: "<p>اجعلي أهدافكِ واضحة، قابلة للقياس، يمكن تحقيقها، ذات صلة بحياتكِ، ومحددة بوقت (SMART). قسمي الهدف الكبير إلى خطوات صغيرة. احتفلي بكل إنجاز، ولا تيأسي عند التعثر، بل تعلمي من أخطائكِ وواصلي المسير.</p>" },
    { title: "📱 التعامل مع وسائل التواصل الاجتماعي بحكمة", preview: "السوشيال ميديا سلاح ذو حدين. كيف تستخدمينه لصالحكِ؟...", full: "<p>حددي وقتاً معيناً لتصفحها. تابعي الحسابات الملهمة والمفيدة التي تضيف لكِ قيمة. كوني واعية بأن ما ترينه ليس دائماً الحقيقة الكاملة. لا تجعليها مصدراً لتقييم ذاتكِ أو مقارنة حياتكِ بحياة الآخرين. احفظي وقتكِ وقلبكِ.</p>" },
    { title: "🤲 قوة الدعاء وأثره في تغيير الأقدار", preview: "الدعاء هو العبادة، وهو صلة مباشرة بينكِ وبين خالقكِ...", full: "<p>لا تستهيني بقوة الدعاء. ارفعي يديكِ بثقة ويقين في كل وقت، في السراء والضراء. تحري أوقات الإجابة، وألِحّي في دعائكِ، فالله يحب العبد اللحوح. الدعاء يغير الأقدار ويجلب الخيرات ويصرف الشرور.</p>" },
    { title: "🧕 الحجاب: هوية وعزة وعبادة", preview: "حجابكِ ليس مجرد قطعة قماش، بل هو تاج كرامتكِ وإعلان لعبوديتكِ لله...", full: "<p>الحجاب طاعة لله قبل كل شيء، وهو حماية لكِ من النظرات المريبة، ورمز لعفتكِ وطهارتكِ. ارتديه بفخر واعتزاز، واجعليه جزءاً من شخصيتكِ وهويتكِ الإسلامية التي تميزكِ بالخير.</p>" },
    { title: "❤️ بر الوالدين: مفتاح التوفيق", preview: "رضا الله في رضا الوالدين. كيف تكسبين هذا الكنز العظيم؟...", full: "<p>كوني لهما ابنة بارة، بالكلمة الطيبة، والخدمة، والدعاء لهما في ظهر الغيب. استمعي لنصائحهما، وأظهري لهما الحب والاحترام. بر الوالدين من أعظم أسباب التوفيق في الدنيا والآخرة، فلا تفرطي فيه.</p>" },
    { title: "😊 ابتسمي، فالابتسامة صدقة", preview: "ابتسامتكِ في وجه أختكِ صدقة. لا تبخلي بهذه العبادة السهلة...", full: "<p>الابتسامة تفتح القلوب، وتزيل الحواجز، وتنشر طاقة إيجابية من حولكِ. هي لغة عالمية يفهمها الجميع. اجعليها عادة يومية، فهي لا تكلف شيئاً ولكنها تساوي الكثير عند الله وفي قلوب الناس.</p>" },
    { title: "💧 أهمية الماء لصحتك وجمالك", preview: "الماء هو سر الحياة. هل تشربين ما يكفي منه يومياً؟...", full: "<p>شرب الماء بكميات كافية يساعد في ترطيب بشرتكِ، تحسين وظائف الجسم، زيادة طاقتكِ، والمساعدة في إنقاص الوزن. اجعلي قنينة الماء رفيقتكِ الدائمة، واشربي حتى قبل أن تشعري بالعطش.</p>" },
    { title: "😴 النوم الجيد: سر الطاقة والجمال", preview: "النوم ليس رفاهية، بل هو ضرورة لصحة عقلكِ وجسدكِ...", full: "<p>الحصول على 7-9 ساعات من النوم الجيد ليلاً يساعد على تجديد خلايا الجسم، تحسين الذاكرة والتركيز، وتقليل التوتر. هيئي جواً مناسباً للنوم، وابتعدي عن الشاشات قبل موعد نومكِ بساعة على الأقل.</p>" },
    { title: "🚶‍♀️ المشي: رياضة بسيطة بفوائد عظيمة", preview: "لا تحتاجي لنادٍ رياضي باهظ. المشي رياضة مجانية ومتاحة للجميع...", full: "<p>خصصي 30 دقيقة يومياً للمشي السريع. هذه العادة البسيطة تقوي قلبكِ، تحسن مزاجكِ، تساعد على التحكم في الوزن، وتقلل من خطر الإصابة بالكثير من الأمراض. استمتعي بالمشي في الهواء الطلق واستمعي لشيء مفيد أثناء ذلك.</p>" },
    { title: "⏳ اغتنمي شبابك قبل هرمك", preview: "فترة الشباب هي فترة القوة والنشاط. كيف تستثمرينها في طاعة الله؟...", full: "<p>استثمري وقتكِ في طلب العلم الشرعي، حفظ القرآن، تعلم مهارات جديدة، والأعمال التطوعية. كل جهد تبذلينه الآن في الخير سيكون لكِ ذخراً في الدنيا والآخرة. لا تضيعي هذه المرحلة الذهبية من عمركِ.</p>" },
    { title: "💬 فن الحوار والاستماع", preview: "كوني مستمعة جيدة قبل أن تكوني متحدثة بارعة...", full: "<p>عندما تتحدثين مع الآخرين، أعطيهم كامل انتباهكِ. لا تقاطيعهم، وحاولي فهم وجهة نظرهم. هذا الأسلوب يكسبكِ احترامهم ومحبتهم ويجعل منكِ شخصية مؤثرة ومحبوبة.</p>" },
    { title: "📚 القراءة: غذاء العقل والروح", preview: "خصصي وقتاً يومياً للقراءة، حتى لو كانت 15 دقيقة فقط...", full: "<p>القراءة تفتح لكِ عوالم جديدة، تزيد من ثقافتكِ، وتطور من طريقة تفكيركِ. نوعي في قراءاتكِ بين الكتب الدينية، كتب تطوير الذات، الروايات الهادفة، والكتب العلمية. اجعلي الكتاب صديقكِ الدائم.</p>" },
    { title: "🎁 فن تقديم الهدية", preview: "تهادوا تحابوا. الهدية ليست بقيمتها المادية، بل بمعناها...", full: "<p>الهدية تعبير عن المحبة والاهتمام. اختاري هدية تناسب شخصية من تهدينها له. لا تنسي أن طريقة التقديم والتغليف جزء مهم من الهدية. حتى لو كانت شيئاً بسيطاً، فإنها تترك أثراً كبيراً في النفس.</p>" },
    { title: "🌍 كوني سفيرة لدينكِ بأخلاقكِ", preview: "أفضل طريقة للدعوة إلى الله هي أن تكوني قرآناً يمشي على الأرض...", full: "<p>أخلاقكِ، صدقكِ، أمانتكِ، وحجابكِ كلها وسائل دعوية صامتة ومؤثرة. كوني قدوة حسنة في تعاملاتكِ مع الجميع، مسلمين وغير مسلمين. الناس يتأثرون بما يرون أكثر مما يسمعون.</p>" },
    { title: "💰 إدارة مصروفكِ الشخصي بذكاء", preview: "تعلمي أساسيات الإدارة المالية منذ الآن...", full: "<p>خصصي جزءاً من مصروفكِ للادخار، وجزءاً للصدقة، والباقي لاحتياجاتكِ. تجنبي الإسراف والتبذير. هذه المهارة ستفيدكِ كثيراً في مستقبلكِ وتجعلكِ شخصية مسؤولة.</p>" },
    { title: "🏡 دوركِ في ترتيب ونظافة بيتكِ", preview: "النظافة من الإيمان. مساهمتكِ في بيتكِ عبادة وأجر...", full: "<p>مساعدة والدتكِ في أعمال المنزل واجب وبر. الحفاظ على غرفتكِ مرتبة ونظيفة يعكس شخصيتكِ المنظمة ويجلب الراحة النفسية. احتسبي الأجر في كل عمل تقومين به في بيتكِ.</p>" },
    { title: "😌 الرضا بالقضاء والقدر", preview: "من أركان الإيمان: الإيمان بالقدر خيره وشره. كيف نحقق ذلك؟...", full: "<p>الرضا لا يعني عدم الحزن، بل يعني التسليم لحكم الله وعدم الاعتراض عليه. ثقي بأن كل ما يحدث لكِ هو لحكمة يعلمها الله. هذا اليقين يجلب لقلبكِ طمأنينة عجيبة ويجعلكِ أقوى في مواجهة مصاعب الحياة.</p>" },
    { title: "🙏 شكر النعم: مفتاح الزيادة", preview: "{لَئِن شَكَرتُم لَأَزيدَنَّكُم}. الشكر ليس فقط باللسان...", full: "<p>اشكري الله على نعمه التي لا تعد ولا تحصى. الشكر يكون بالقلب اعترافاً، وباللسان حمداً وثناءً، وبالجوارح عملاً وطاعة. تأملي نعم الله عليكِ كل يوم، من نعمة الصحة إلى نعمة الهداية، وستجدين حياتكِ مليئة بالبركة.</p>" },
    { title: "🤝 أهمية صلة الرحم", preview: "صلة الرحم تزيد في العمر والرزق. لا تقطعي أرحامكِ...", full: "<p>خصصي وقتاً لزيارة أقاربكِ أو الاتصال بهم للسؤال عن أحوالهم. شاركيهم أفراحهم وأحزانهم. صلة الرحم من أحب الأعمال إلى الله، وهي سبب مباشر للبركة في حياتكِ.</p>" },
    { title: "🤫 حفظ اللسان وأهميته", preview: "وهل يكب الناس في النار على وجوههم إلا حصائد ألسنتهم؟...", full: "<p>احفظي لسانكِ عن الغيبة والنميمة والكذب والكلام الفاحش. اجعلي كلامكِ طيباً أو اصمتي. الكلمة الطيبة صدقة، وهي ترفعكِ درجات عند الله وعند الناس. تذكري أن كل كلمة تقولينها مسجلة عليكِ.</p>" }
];

// --- App Logic ---
// Wrapped all code in DOMContentLoaded to ensure HTML is ready before script runs.
document.addEventListener('DOMContentLoaded', () => {

    const appHeader = document.getElementById('appHeader');
    const tabButtons = document.querySelectorAll('.tab-bar button');
    const pages = document.querySelectorAll('.page');
    const onboardingModal = document.getElementById('onboardingModal');
    const dayClickModal = document.getElementById('dayClickModal');
    const onboardingForm = document.getElementById('onboardingForm');
    const monthYearEl = document.getElementById('monthYear');
    const daysGrid = document.getElementById('daysGrid');
    const prevMonthBtn = document.getElementById('prevMonthBtn');
    const nextMonthBtn = document.getElementById('nextMonthBtn');
    const notesInput = document.getElementById('notesInput');
    const saveNotesBtn = document.getElementById('saveNotesBtn');
    const saveSettingsBtn = document.getElementById('saveSettingsBtn');
    const fatwasContainer = document.getElementById('fatwasContainer');
    const articlesContainer = document.getElementById('articlesContainer');
    const deleteLastCycleBtn = document.getElementById('deleteLastCycleBtn');
    const fullResetBtn = document.getElementById('fullResetBtn');
    const startPeriodBtnModal = document.getElementById('startPeriodBtnModal');
    const endPeriodBtnModal = document.getElementById('endPeriodBtnModal');
    const closeDayClickModalBtn = document.getElementById('closeDayClickModalBtn');

    let currentCalendarDate = new Date();
    let selectedDateForModal = null;

    function showPage(pageId) {
        pages.forEach(page => page.classList.remove('active'));
        document.getElementById(pageId).classList.add('active');
        tabButtons.forEach(button => button.classList.toggle('active', button.dataset.page === pageId));
        const pageTitles = {
            menstrualCalendar: 'رفيقة 💕 - تقويم الدورة الشهرية',
            statistics: '📊 إحصائيات دورتكِ',
            religiousFatwas: '🧕 فتاوى الطهارة والدورة',
            articles: '📚 مقالات ثقافية ودينية',
            settings: '⚙️ الإعدادات',
            personalNotes: '💬 ملاحظاتي الشخصية'
        };
        appHeader.textContent = pageTitles[pageId] || 'رفيقة 💕';
        if (pageId === 'statistics') calculateAndDisplayStats();
        if (pageId === 'settings') loadSettingsToUI();
    }
    tabButtons.forEach(button => button.addEventListener('click', () => showPage(button.dataset.page)));

    function checkOnboarding() {
        if (!localStorage.getItem('isSetupComplete')) {
            onboardingModal.classList.add('active');
        } else {
            initializeApp();
        }
    }
    onboardingForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const cycleLength = document.getElementById('onboardingCycleLength').value;
        const periodLength = document.getElementById('onboardingPeriodLength').value;
        const lastPeriodDate = document.getElementById('onboardingLastPeriod').value;
        const userSettings = { cycleLength: parseInt(cycleLength), periodLength: parseInt(periodLength) };
        localStorage.setItem('userSettings', JSON.stringify(userSettings));
        if (lastPeriodDate) {
            const startDate = new Date(lastPeriodDate);
            startDate.setHours(0, 0, 0, 0);
            const cycle = { startDate: startDate.toISOString(), endDate: null };
            localStorage.setItem('allPeriodCycles', JSON.stringify([cycle]));
        }
        localStorage.setItem('isSetupComplete', 'true');
        onboardingModal.classList.remove('active');
        initializeApp();
    });
    function initializeApp() {
        showPage('menstrualCalendar');
        generateCalendar(currentCalendarDate.getFullYear(), currentCalendarDate.getMonth());
        loadNotes();
        populateContent();
        setupTrackers();
    }

    function populateContent() {
        fatwasContainer.innerHTML = fatwasData.map(item => createArticleBoxHTML(item.title, item.preview, item.full, item.source, "المزيد من الفتوى")).join('');
        articlesContainer.innerHTML = articlesData.map(item => createArticleBoxHTML(item.title, item.preview, item.full, null, "اقرئي المزيد")).join('');
        addToggleListeners();
    }
    function createArticleBoxHTML(title, preview, full, source, moreText) {
        const sourceLink = source ? `<p style="font-size: 13px; text-align: left;"><a href="${source}" target="_blank" class="read-more">المصدر: موقع ابن باز</a></p>` : '';
        return `<div class="article-box"><h3>${title}</h3><p class="article-preview">${preview}</p><div class="article-full-content">${full}${sourceLink}</div><button class="toggle-article">${moreText} »</button></div>`;
    }
    function addToggleListeners() {
        document.querySelectorAll('.toggle-article').forEach(button => {
            button.addEventListener('click', (event) => {
                const fullContent = event.target.previousElementSibling;
                const isActive = fullContent.classList.toggle('active');
                event.target.textContent = isActive ? 'أقل «' : `${button.textContent.split(' ')[0]} »`;
            });
        });
    }

    function getUserSettings() { return JSON.parse(localStorage.getItem('userSettings')) || { cycleLength: 28, periodLength: 5 }; }
    function loadSettingsToUI() {
        const settings = getUserSettings();
        document.getElementById('settingCycleLength').value = settings.cycleLength;
        document.getElementById('settingPeriodLength').value = settings.periodLength;
    }
    
    saveSettingsBtn.addEventListener('click', () => {
        const cycleLength = document.getElementById('settingCycleLength').value;
        const periodLength = document.getElementById('settingPeriodLength').value;
        const newSettings = { cycleLength: parseInt(cycleLength), periodLength: parseInt(periodLength) };
        localStorage.setItem('userSettings', JSON.stringify(newSettings));
        alert('تم حفظ الإعدادات بنجاح!');
        generateCalendar(currentCalendarDate.getFullYear(), currentCalendarDate.getMonth());
    });

    deleteLastCycleBtn.addEventListener('click', () => {
        if (confirm('هل أنتِ متأكدة من رغبتك في حذف آخر دورة مسجلة؟ لا يمكن التراجع عن هذا الإجراء.')) {
            let cycles = JSON.parse(localStorage.getItem('allPeriodCycles') || '[]');
            if (cycles.length > 0) {
                cycles.pop();
                localStorage.setItem('allPeriodCycles', JSON.stringify(cycles));
                alert('تم حذف آخر دورة بنجاح.');
                generateCalendar(currentCalendarDate.getFullYear(), currentCalendarDate.getMonth());
            } else {
                alert('لا توجد دورات مسجلة لحذفها.');
            }
        }
    });

    fullResetBtn.addEventListener('click', () => {
        if (confirm('تحذير! سيؤدي هذا إلى حذف جميع بياناتكِ نهائياً (الدورات، الإعدادات، الملاحظات) والبدء من جديد. هل أنتِ متأكدة؟')) {
            localStorage.clear();
            alert('تم إعادة تعيين التطبيق.');
            location.reload();
        }
    });

    function startPeriod(date) {
        let cycles = JSON.parse(localStorage.getItem('allPeriodCycles') || '[]');
        const isPeriodActive = cycles.some(c => c.endDate === null);
        if (isPeriodActive) {
            alert('لا يمكن بدء دورة جديدة بينما توجد دورة أخرى نشطة لم تنتهِ بعد.');
            return;
        }
        cycles.push({ startDate: date.toISOString(), endDate: null });
        localStorage.setItem('allPeriodCycles', JSON.stringify(cycles));
        alert(`تم تسجيل بداية الدورة في ${date.toLocaleDateString('ar-EG')}`);
        generateCalendar(currentCalendarDate.getFullYear(), currentCalendarDate.getMonth());
        dayClickModal.classList.remove('active');
    }

    function endPeriod(date) {
        let cycles = JSON.parse(localStorage.getItem('allPeriodCycles') || '[]');
        const activeCycleIndex = cycles.findIndex(c => c.endDate === null);
        if (activeCycleIndex === -1) {
            alert('لا توجد دورة نشطة لتسجيل انتهائها. يرجى تسجيل بداية الدورة أولاً.');
            return;
        }
        const startDate = new Date(cycles[activeCycleIndex].startDate);
        if (date < startDate) {
            alert('تاريخ انتهاء الدورة لا يمكن أن يكون قبل تاريخ بدايتها.');
            return;
        }
        cycles[activeCycleIndex].endDate = date.toISOString();
        localStorage.setItem('allPeriodCycles', JSON.stringify(cycles));
        alert(`تم تسجيل نهاية الدورة في ${date.toLocaleDateString('ar-EG')}`);
        generateCalendar(currentCalendarDate.getFullYear(), currentCalendarDate.getMonth());
        dayClickModal.classList.remove('active');
    }

    function generateCalendar(year, month) {
        daysGrid.innerHTML = '';
        const settings = getUserSettings();
        const cycles = JSON.parse(localStorage.getItem('allPeriodCycles') || '[]');
        cycles.sort((a,b) => new Date(a.startDate) - new Date(b.startDate));
        const monthNames = ['يناير', 'فبراير', 'مارس', 'أبريل', 'مايو', 'يونيو', 'يوليو', 'أغسطس', 'سبتمبر', 'أكتوبر', 'نوفمبر', 'ديسمبر'];
        monthYearEl.textContent = `${monthNames[month]} ${year}`;

        const firstDayOfMonth = new Date(year, month, 1);
        const daysInMonth = new Date(year, month + 1, 0).getDate();
        let startDayOfWeek = firstDayOfMonth.getDay();

        for (let i = 0; i < startDayOfWeek; i++) {
            const emptyCell = document.createElement('div');
            emptyCell.classList.add('day', 'empty');
            daysGrid.appendChild(emptyCell);
        }

        for (let day = 1; day <= daysInMonth; day++) {
            const dayEl = document.createElement('div');
            dayEl.classList.add('day');
            const currentDate = new Date(year, month, day);
            currentDate.setHours(0,0,0,0);
            
            const today = new Date();
            today.setHours(0,0,0,0);
            if(currentDate.getTime() === today.getTime()){
                dayEl.classList.add('today');
            }

            let dayType = 'safe-day';
            let isLoggedPeriod = false;

            for(const cycle of cycles){
                const startDate = new Date(cycle.startDate);
                if (!cycle.endDate) {
                    const estimatedEndDate = new Date(startDate.getTime() + (settings.periodLength - 1) * 86400000);
                     if(currentDate >= startDate && currentDate <= estimatedEndDate) {
                         dayType = 'period';
                         isLoggedPeriod = true;
                         break;
                     }
                } else {
                    const endDate = new Date(cycle.endDate);
                    if(currentDate >= startDate && currentDate <= endDate){
                        dayType = 'period';
                        isLoggedPeriod = true;
                        break;
                    }
                }
            }
            
            if(!isLoggedPeriod && cycles.length > 0){
                const lastCycleStart = new Date(cycles[cycles.length - 1].startDate);
                let referenceDate = lastCycleStart;

                // Loop to find the correct reference cycle start for the current date
                while (true) {
                    let nextCycleStartDate = new Date(referenceDate.getTime() + settings.cycleLength * 86400000);
                    if (currentDate < nextCycleStartDate) {
                        break;
                    }
                    referenceDate = nextCycleStartDate;
                }

                let dayInCycle = Math.round((currentDate - referenceDate) / 86400000);

                if (dayInCycle >= 0 && dayInCycle < settings.periodLength) dayType = 'period';
                else if (dayInCycle >= settings.cycleLength - 16 && dayInCycle <= settings.cycleLength - 13) dayType = 'ovulation';
                else if (dayInCycle >= settings.cycleLength - 7 && dayInCycle < settings.cycleLength) dayType = 'pre-period';
                else dayType = 'safe-day';
            }

            let emoji = ' ';
            switch(dayType) {
                case 'period': emoji = '🩸'; break;
                case 'ovulation': emoji = '🌸'; break;
                case 'pre-period': emoji = '✨'; break;
                case 'safe-day': emoji = '☁️'; break;
            }

            dayEl.classList.add(dayType);
            dayEl.innerHTML = `<span class="day-number">${day}</span><span class="emoji">${emoji}</span>`;
            dayEl.dataset.date = currentDate.toISOString();
            dayEl.addEventListener('click', () => {
                if (dayEl.classList.contains('empty')) return;
                selectedDateForModal = new Date(dayEl.dataset.date);
                document.getElementById('dayClickModalTitle').textContent = `خيارات يوم: ${selectedDateForModal.toLocaleDateString('ar-EG')}`;
                dayClickModal.classList.add('active');
            });
            daysGrid.appendChild(dayEl);
        }
    }
    
    startPeriodBtnModal.addEventListener('click', () => startPeriod(selectedDateForModal));
    endPeriodBtnModal.addEventListener('click', () => endPeriod(selectedDateForModal));
    closeDayClickModalBtn.addEventListener('click', () => dayClickModal.classList.remove('active'));

    prevMonthBtn.addEventListener('click', () => {
        currentCalendarDate.setMonth(currentCalendarDate.getMonth() - 1);
        generateCalendar(currentCalendarDate.getFullYear(), currentCalendarDate.getMonth());
    });
    nextMonthBtn.addEventListener('click', () => {
        currentCalendarDate.setMonth(currentCalendarDate.getMonth() + 1);
        generateCalendar(currentCalendarDate.getFullYear(), currentCalendarDate.getMonth());
    });
    function loadNotes() { notesInput.value = localStorage.getItem('personalNotes') || ''; }
    saveNotesBtn.addEventListener('click', () => {
        localStorage.setItem('personalNotes', notesInput.value);
        alert('تم حفظ ملاحظاتك بنجاح!');
    });
    
    function calculateAndDisplayStats() { 
        const statsContainer = document.getElementById('statsContainer');
        const cycles = JSON.parse(localStorage.getItem('allPeriodCycles') || '[]').filter(c => c.endDate);
        if(cycles.length < 2) {
            statsContainer.innerHTML = "<p>لا توجد بيانات كافية لعرض الإحصائيات. قومي بتسجيل وإتمام دورتين على الأقل.</p>";
            return;
        }

        let totalPeriodLength = 0;
        let totalCycleLength = 0;

        for (let i = 0; i < cycles.length; i++) {
            const start = new Date(cycles[i].startDate);
            const end = new Date(cycles[i].endDate);
            totalPeriodLength += (end - start) / 86400000 + 1;
            
            if (i > 0) {
                const prevStart = new Date(cycles[i-1].startDate);
                totalCycleLength += (start - prevStart) / 86400000;
            }
        }
        
        const avgPeriod = Math.round(totalPeriodLength / cycles.length);
        const avgCycle = Math.round(totalCycleLength / (cycles.length - 1));

        statsContainer.innerHTML = `
            <div class="stats-item">
                <span class="label">💖 متوسط طول الدورة الكاملة</span>
                <span class="value">${avgCycle} يوم</span>
            </div>
            <div class="stats-item">
                <span class="label">🩸 متوسط مدة فترة الحيض</span>
                <span class="value">${avgPeriod} أيام</span>
            </div>
        `;
    }

    function setupTrackers() {
        const todayKey = new Date().toISOString().split('T')[0];
        let dailyData = JSON.parse(localStorage.getItem('dailyData')) || {};

        const moodTracker = document.getElementById('moodTracker');
        const symptomTracker = document.getElementById('symptomTracker');

        function updateSelections() {
            const todayData = dailyData[todayKey] || {};
            moodTracker.querySelectorAll('.mood-option').forEach(opt => {
                opt.classList.toggle('selected', opt.dataset.mood === todayData.mood);
            });
            symptomTracker.querySelectorAll('.symptom-option').forEach(opt => {
                const symptoms = todayData.symptoms || [];
                opt.classList.toggle('selected', symptoms.includes(opt.dataset.symptom));
            });
        }

        moodTracker.addEventListener('click', (e) => {
            if (e.target.classList.contains('mood-option')) {
                if (!dailyData[todayKey]) dailyData[todayKey] = {};
                if (dailyData[todayKey].mood === e.target.dataset.mood) {
                    delete dailyData[todayKey].mood;
                } else {
                    dailyData[todayKey].mood = e.target.dataset.mood;
                }
                localStorage.setItem('dailyData', JSON.stringify(dailyData));
                updateSelections();
            }
        });

        symptomTracker.addEventListener('click', (e) => {
            if (e.target.classList.contains('symptom-option')) {
                if (!dailyData[todayKey]) dailyData[todayKey] = {symptoms: []};
                if (!dailyData[todayKey].symptoms) dailyData[todayKey].symptoms = [];
                const symptom = e.target.dataset.symptom;
                const symptomIndex = dailyData[todayKey].symptoms.indexOf(symptom);
                if (symptomIndex > -1) {
                    dailyData[todayKey].symptoms.splice(symptomIndex, 1);
                } else {
                    dailyData[todayKey].symptoms.push(symptom);
                }
                localStorage.setItem('dailyData', JSON.stringify(dailyData));
                updateSelections();
            }
        });
        updateSelections();
    }
    checkOnboarding();
});
</script>
</body>
</html>